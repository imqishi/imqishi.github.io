<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Nick的回收站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Nick的回收站">
<meta property="og:url" content="http://blog.imqishi.cn/page/2/index.html">
<meta property="og:site_name" content="Nick的回收站">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nick的回收站">
  
    <link rel="alternate" href="/atom.xml" title="Nick的回收站" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Nick的回收站</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.imqishi.cn"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-4.求有序数组的中位数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/04/4.求有序数组的中位数/" class="article-date">
  <time datetime="2017-05-04T07:01:48.000Z" itemprop="datePublished">2017-05-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/04/4.求有序数组的中位数/">求有序数组的中位数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="LeetCode-4"><a href="#LeetCode-4" class="headerlink" title="LeetCode 4"></a>LeetCode 4</h1><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>遍历，分别从两个数组头最小的开始向后走，走到中间为止。这种方法最简单，但是时间复杂度为O(m+n)，那么有没有更快的方法呢？</p>
<p>由题目要求我们的算法时间复杂度为O(log (m+n))可以看出显然是有的，看到log就让人想起二分，没错，这种更快的方法正是利用了二分的原理。</p>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>根据中位数的定义可以知道，中位数是一组数据中位于中间位置的数字，这也就意味着，假设有两个有序数组A和B：</p>
<p>把A分成两部分，分别为0 ~ i-1, i ~ m-1</p>
<p>把B分成两部分，分别为0 ~ j-1, j ~ n-1</p>
<p>可以知道</p>
<p>i-1-0+1 + j-1-0+1 = m-1-i+1 + n-1-j+1</p>
<p>也就是 i + j = (m + n) / 2</p>
<p>这里要注意的是，该式是m+n为偶数时成立的情况，当m+n为奇数时，i+j = (m+n+1) / 2，原因如下：</p>
<h3 id="首先我们要搞清楚，按这种分法，中位数在哪里产生："><a href="#首先我们要搞清楚，按这种分法，中位数在哪里产生：" class="headerlink" title="首先我们要搞清楚，按这种分法，中位数在哪里产生："></a>首先我们要搞清楚，按这种分法，中位数在哪里产生：</h3><ol>
<li>如果是偶数的话，显然应该是i-1和j-1的较大者与i和j的较小者的均值</li>
<li>如果是奇数的话，则我们认定为i-1和j-1的较大者</li>
</ol>
<h3 id="在这种情况下，我们进行假设："><a href="#在这种情况下，我们进行假设：" class="headerlink" title="在这种情况下，我们进行假设："></a>在这种情况下，我们进行假设：</h3><p>假设A = [1,2], B = [3,4]，以第一轮为例，i = 2 / 2 = 1, j = 4 / 2 - 1 = 1，注意i和j是数组下标，也就是说，左侧分别有一个下标为0的数，正好是中位数。假设我们+1，i + j = 5 / 2 = 2 正确</p>
<p>假设A = [1, 2], B= [3, 4, 5]，以第一轮为例，如果不+1，i = 2 / 2 = 1, j = 5 / 2 - 1 = 1，由于i和j是数组下标，那么左侧共有两个数，而根据之前的定义左侧应该有3个数，所以只有+1以后才能满足左侧有3个数（此时j = 2）</p>
<p>为什么必须是3个数呢？这要从开始的解题思路说起，因为我们假设分成的两部分是以 i, j 为分割的，那么左侧加起来应该为总长度的一半，此时中位数为左侧最大与右侧最小的均值。如果无法整除，取左侧最大。所以左侧长度要么为一半，要么为一半 +1，故i + j = (m + n + 1) / 2</p>
<p>为什么要保证m &lt; n呢？因为如果m &gt; n，i比较大，有可能会出现j为负数的情况。</p>
<h3 id="那么搜索的时候有哪些情况呢？"><a href="#那么搜索的时候有哪些情况呢？" class="headerlink" title="那么搜索的时候有哪些情况呢？"></a>那么搜索的时候有哪些情况呢？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;a&gt; (j == 0 or i == m or B[j-1] &lt;= A[i]) and</div><div class="line">    (i == 0 or j = n or A[i-1] &lt;= B[j])</div><div class="line">    i即为所求.</div><div class="line"></div><div class="line">&lt;b&gt; j &gt; 0 and i &lt; m and B[j - 1] &gt; A[i]</div><div class="line">    i太小，应该增加（j会相应减小）.</div><div class="line"></div><div class="line">&lt;c&gt; i &gt; 0 and j &lt; n and A[i - 1] &gt; B[j]</div><div class="line">    i太大，应该减小（j会相应增加）.</div></pre></td></tr></table></figure>
<h3 id="综上，代码如下："><a href="#综上，代码如下：" class="headerlink" title="综上，代码如下："></a>综上，代码如下：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">median</span><span class="params">(A, B)</span>:</span></div><div class="line">   m, n = len(A), len(B)</div><div class="line">   <span class="keyword">if</span> m &gt; n:</div><div class="line">       A, B, m, n = B, A, n, m</div><div class="line">   <span class="keyword">if</span> n == <span class="number">0</span>:</div><div class="line">       <span class="keyword">raise</span> ValueError</div><div class="line"></div><div class="line">   imin, imax, half_len = <span class="number">0</span>, m, (m + n + <span class="number">1</span>) / <span class="number">2</span></div><div class="line">   <span class="keyword">while</span> imin &lt;= imax:</div><div class="line">       i = (imin + imax) / <span class="number">2</span></div><div class="line">       j = half_len - i</div><div class="line">       <span class="keyword">if</span> i &lt; m <span class="keyword">and</span> B[j<span class="number">-1</span>] &gt; A[i]:</div><div class="line">           <span class="comment"># i is too small, must increase it</span></div><div class="line">           imin = i + <span class="number">1</span></div><div class="line">       <span class="keyword">elif</span> i &gt; <span class="number">0</span> <span class="keyword">and</span> A[i<span class="number">-1</span>] &gt; B[j]:</div><div class="line">           <span class="comment"># i is too big, must decrease it</span></div><div class="line">           imax = i - <span class="number">1</span></div><div class="line">       <span class="keyword">else</span>:</div><div class="line">           <span class="comment"># i is perfect</span></div><div class="line"></div><div class="line">		<span class="comment"># i = 0意味着数组A太大了，走到左侧的头了，左侧只有B了，所以左侧的最大值应该为B[j-1]</span></div><div class="line">           <span class="keyword">if</span> i == <span class="number">0</span>: max_of_left = B[j<span class="number">-1</span>]</div><div class="line">           <span class="comment"># j = 0意味着B太大了，指针走到左侧的头了，左侧只有A了，所以左侧最大值应该为A[i-1]</span></div><div class="line">           <span class="keyword">elif</span> j == <span class="number">0</span>: max_of_left = A[i<span class="number">-1</span>]</div><div class="line">           <span class="comment"># 否则说明中位数的第一个数字（左侧较大的）在两组数据的中间位置</span></div><div class="line">           <span class="keyword">else</span>: max_of_left = max(A[i<span class="number">-1</span>], B[j<span class="number">-1</span>])</div><div class="line"></div><div class="line">		<span class="comment"># 根据上面的分析知道如果是奇数，该数就是中位数</span></div><div class="line">           <span class="keyword">if</span> (m + n) % <span class="number">2</span> == <span class="number">1</span>:</div><div class="line">               <span class="keyword">return</span> max_of_left</div><div class="line"></div><div class="line">		<span class="comment"># 如果i走到最右边，说明A太小了，右侧只有B，所以右侧最小值是B[j]</span></div><div class="line">           <span class="keyword">if</span> i == m: min_of_right = B[j]</div><div class="line">           <span class="comment"># 如果j走到最右边，说明B太小了，右侧只有A，所以右侧最小值是A[i]</span></div><div class="line">           <span class="keyword">elif</span> j == n: min_of_right = A[i]</div><div class="line">           <span class="comment"># 否则说明中位数的第二个数字(右侧较小的)在两组数据的中间位置</span></div><div class="line">           <span class="keyword">else</span>: min_of_right = min(A[i], B[j])</div><div class="line"></div><div class="line">		<span class="comment"># 如果是偶数，应该为左侧最大与右侧最小值的均值</span></div><div class="line">           <span class="keyword">return</span> (max_of_left + min_of_right) / <span class="number">2.0</span></div></pre></td></tr></table></figure>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>解题过程中遇到的问题与解决思路主要有两个：</p>
<ol>
<li>第一次尝试解题，没能把中位数的概念运用好，i和j之间的关系没有用起来，导致i与j各自独立，计算的时候混乱。</li>
<li>第二次尝试解题，注意了i与j之间的关系，但是对于 m + n + 1 中为什么+1没搞清楚，至于为什么+1，在上面已经讲清楚了。</li>
<li>如果说还有小的点，那就是对imin和imax的设置了，一定要注意是 i + 1或者 i - 1 ，不是设置成1…这算是二分的基本点了。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.imqishi.cn/2017/05/04/4.求有序数组的中位数/" data-id="cj652vbno00054a1yr5iifb68" class="article-share-link">Partager</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/leetcode/">leetcode</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-近期总结与下一步计划" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/04/17/近期总结与下一步计划/" class="article-date">
  <time datetime="2017-04-17T07:01:48.000Z" itemprop="datePublished">2017-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/04/17/近期总结与下一步计划/">近期总结与下一步计划</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="托福"><a href="#托福" class="headerlink" title="托福"></a>托福</h1><p>托福是此次回京以来的重点照顾对象，这次托福的准备以及考试过程都给我留下了深刻的印象。自高考以来，很久没有像这次准备托福一样这么用心的去准备一门考试了。起因很简单，就是感觉自己这几年进步太慢，周围学习生活不尽如人意，想要做出一些改变，或是想自己有所提高，亦或是想要证明些什么吧。不过想想，又有什么好证明的呢，又有什么意思呢，所谓证明，或许不过是自己的自卑罢了。</p>
<p>先说说开始的心得。虽然报名早，但是辗转折腾了很久，真正准备的时间也就是这次回来的两个月。不得不说，之前自己的确是有些过于自信了。准备之初，想想当时好友说刷了一个月题考了103…还有不少感觉水平相当的都考过了，所以一直以为应该比较简单。真正做起来才感觉到真正的差距，不禁反问自己是自己变弱了还是怎么的。也曾在准备过程中有过兴奋，有过失意。不过最后总是过来了吧。没有比较就没有伤害啊哈哈，不论如何这一波也是狠锻炼了一下，不论结果如何，找清差距，继续努力吧~</p>
<p>再扯扯通过托福的学习我（自认为）得到了什么：</p>
<ol>
<li><p>英语水平。就算是自己曾经引以为豪的阅读类题目，开始的时候也是撞了个大跟头，三篇文章看似不长，却无法快速把握核心思想，看不懂单词，或者是看完了也不知道在说什么。从老弟那里lou来的辅导书不错，帮我快速的了解了一些套路，可以更加快速的审题；还有词汇，词汇是记不完滴，虽然之前感觉用APP记的已经够熟练了，这波TOEFL的词以类记让我认识到APP上的不过是冰山一角…好多奇奇怪怪的但是常见的词APP里都木有…以至于第一次去找老弟的时候他随便问了几个常见词我竟然都！没！见！过！我怀疑我用了假的背单词软件…0.0然后就是口语能力吧，其实也不能算口语能力，口语还是比较烂的，不过现在经过一波听课还有几天的集中训练，基本上有了话题能够在几秒内快速准备说出点儿什么来了，以前的时候一直是纸上谈兵，这回算是真枪实弹，提高了一波~写作的话感觉一直以来都是老套路，所以考前就看了下怎么考的，有没有可以用的套路，直接去怼了，然而我现在感觉写作估计考的还不错，也是醉…最让我认识到差距的是听力，到现在为止我的听力还是炸的不行，主要是托福考试这都考的啥啊，天文地理心理学社会学人类学历史学…我一个工科男，出个计算机学就那么难嘛=.=听力还是要多加练习，不过经过这一波听写训练+泛听，现在对日常的对话还有电影啥的不是太奇葩的应该都比原来熟练了很多，并且托福训练的材料也拓宽了我上面那一堆题材的知识面，算是个意外收获吧~</p>
</li>
<li><p>思考问题的能力还有逻辑能力。在托福考试的过程中，我深切的体会了一把西方套路的简洁实用，和以前学习语文的时候形成了鲜明的对比。我觉得西方人的务实与简洁的思想我们十分有必要学习，就像看网课的时候辅导老师说的一样，中国人说话总是说不清楚，就算能说出论点来，其他地方通常也是支支吾吾，糊弄糊弄就过去了，并且中国人很喜欢做铺垫，很简单的一件事儿，非得拿很长很冗余的篇幅去做铺垫，balabala啰嗦一堆还不一定能让别人看懂想干什么（你还别说我们的文化里可能真就觉着这样子很厉害，让人看不明白最后给个高大上的结论很厉害）。而西方的行事风格迥然不同，一个文章、一个段落，基本上大部分都是上来先表明论点或者态度，然后再用例子去证明，让人一上来就可以知道你在讨论什么，感觉很清晰。我觉得至少我现在就很缺乏这种思想，首先，要找清楚你想做什么，然后再去一步一步的向这个点前进。而不是成天糊弄自己，学点这，学点那，没有目的性，还想美其名曰“韬光养晦”、“全面发展”云云。我越来越感觉到找到自己想做什么十分重要。</p>
</li>
</ol>
<p>英语是一项非常实用的技能，即使这次考试已经结束了，我觉得每天做一些必要的学习还是十分重要的。现在我的听力水平还很弱，以后要多听，多看剧…2333~</p>
<h1 id="二懒猫成功通过复试"><a href="#二懒猫成功通过复试" class="headerlink" title="二懒猫成功通过复试"></a>二懒猫成功通过复试</h1><p>盼望着，盼望着，复试来了，心情更加紧张了~咳咳，回正题…我们家二懒猫终于如愿以偿的通过了复试！并且还是首选的那个最心仪的导师，热烈鼓掌！两年的付出终于有了回报，我也感到十分开心^_^~一路走来实在不容易，不过总算是熬过来啦，又是新的开始咯~一起努力吧！</p>
<h1 id="今后打算"><a href="#今后打算" class="headerlink" title="今后打算"></a>今后打算</h1><ol>
<li><p>继续学英语，多听听力，看美剧</p>
</li>
<li><p>开始刷题！LeetCode项目正式启动！尝试了一波Java感觉PHP这个毒语言已经把我养的太挑剔了，感觉Java好繁琐，但是总感觉PHP逼格不够（囧）所以决定用Python啦~</p>
</li>
<li><p>健身、游泳</p>
</li>
<li><p>该玩玩该浪浪</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.imqishi.cn/2017/04/17/近期总结与下一步计划/" data-id="cj652vbo0000k4a1y5vsrphc1" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-第一篇博客" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/16/第一篇博客/" class="article-date">
  <time datetime="2017-01-16T13:27:13.000Z" itemprop="datePublished">2017-01-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/16/第一篇博客/">第一篇博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>其实在这台腾讯云主机购买之前，我还买过一个阿里云的主机用了一段时间，但是那段时间一直把阿里云的那台机器扔在一旁并没有用过。这次又买了这个主机，开始的时候并不想买，因为有之前的那次失败的购买经历，买了以后啥都没干，扔了几个月白浪费了几十块。但是想想有时候还是需要记点东西的，在经过了大四一年研一半年的时光之后个人也有了点略微的想法，就搞一个耍耍咯~</p>
<p>第一篇博客写什么呢？想不起来。我曾经想象过买了主机购了域名，我要干啥干啥，做点有意义的事情。但是这个世界上并没有那么多有意义的事情让你去做。那我就做些对自己可能有些用的事情好啦。比如…我买来的第一件事是搭了个seafile网盘（也是醉了）然后最近在写DNS的相关东西，就趁热打铁买了个域名，配了几条A记录上来，然后又搞了个反代，自己玩儿了几个简单的东西还搞得不亦乐乎，可能这就是我这种初学之人的奇葩的乐趣吧~</p>
<h1 id="Seafile云盘"><a href="#Seafile云盘" class="headerlink" title="Seafile云盘"></a>Seafile云盘</h1><p>Seafile 是国内团队开发、国际领先的开源企业云存储软件,为企业提供私有云环境下的网盘解决方案,满足文件集中管理、多终端访问、共享协作等需求。然而，我只是把它当个个人网盘，还不能放大东西，因为我虚机存储有限，并且带宽也只有1Mbps…^_^</p>
<p>又扯远了…<a href="https://www.seafile.com/download/" target="_blank" rel="external">官网</a>下载对应的Linux服务器端文件，有时候会提示网站没备案，多点几次就会好的（醉）…可以直接在虚机执行</p>
<p><code>wget http://download-cn.seafile.com/seafile-server_6.0.7_x86-64.tar.gz</code> </p>
<p>然后解压</p>
<p><code>tar -xzvf seafile-server_6.0.7_x86-64.tar.gz</code></p>
<p>seafile依赖Python2.7以及MySQL（或者是SQLite）因为平时开发啥的经常用MySQL，就选了前者，他官网给的是一个MySQL的精简版类似于，叫mariadb，安装方法为：</p>
<p><code>yum install mariadb-server</code></p>
<p>这玩意儿奇葩的是，他的运行还是叫service mysql start…</p>
<p>总而言之先运行起来咯，然后就可以简单粗暴的在刚才解压的seafile文件里面</p>
<p><code>./setup-seafile-mysql.sh  #运行安装脚本并回答预设问题</code></p>
<p>之后就可以启动seafile和seahub，使用网盘啦~</p>
<p><code>./seafile.sh start # 启动 Seafile 服务</code><br><code>./seahub.sh start &lt;port&gt;  # 启动 Seahub 网站 （默认运行在8000端口上）</code></p>
<p>可以通过输入 <a href="http://your_ip:8000" target="_blank" rel="external">http://your_ip:8000</a> 访问seafile</p>
<p>其他参考来自<a href="https://manual-cn.seafile.com/deploy/using_mysql.html" target="_blank" rel="external">seafile官方文档</a> 给官方文档点赞，简单易懂~</p>
<h1 id="配置域名及反向代理"><a href="#配置域名及反向代理" class="headerlink" title="配置域名及反向代理"></a>配置域名及反向代理</h1><p>距离上次编辑又过了有一段时间啦，期间一直在收拾回家还有年会的一些事情。还有一个问题就是配置的过程中确实出现了一些波折。今天有时间了，来总结一下：</p>
<h2 id="第一次尝试"><a href="#第一次尝试" class="headerlink" title="第一次尝试"></a>第一次尝试</h2><p>最早的时候并没有打算搞域名。直到买了服务器过了段时间考完试了，打算自己弄点东西耍耍，可是却发现不知道服务器的公网IP，去管理端查了一下，又是一串并不好记的数字。恰好那段时间在做DNS线路检测的相关部分，就决定自己也买个域名玩玩儿，还顺路看了一些DNS的入门教程，如权威查询、递归查询、域、线路、权威域、反向域、转发域等等…说来惭愧，虽然写过一丢丢DNS的业务逻辑代码，对其中的工作原理却一直没有怎么看过。感觉这几个算是可以快速学习入门概念的：<a href="http://www.toxingwang.com/linux-unix/linux-admin/1165.html" target="_blank" rel="external">DNS基本概念学习</a></p>
<p>购买域名以后，进入腾讯云的云解析控制台，点击所购买的域名imqishi.cn右侧的 解析 标志进入记录管理页面。</p>
<p>按照默认的配置，添加了一条A记录，主机类型走默认@，记录值处填写云服务器的公网IP地址，一个最简单的配置完成了。原来需要输入IP:8000才可以访问Seafile的web服务，现在只需要输入：imqishi.cn:8000就可以了~</p>
<h2 id="进一步改进"><a href="#进一步改进" class="headerlink" title="进一步改进"></a>进一步改进</h2><p>不久以后，我发现，ssh到虚机需要 <code>ssh root@imqishi.cn</code>  ，访问云盘又是 <code>imqishi.cn:8000</code> ，后来建了博客又是 <code>imqishi.cn:4000</code> ，指不定以后再开启一个什么服务就又是一个新的端口。所谓懒有的时候也是第一生产力，人就是为了图懒，才发明了越来越多的有效的工具。看到腾讯的首页是www.qq.com，云服务是qloud.qq.com。我就想我要不要也玩玩二级域名？这样的话就不用记麻烦的端口号了。吴神对此并不感到有啥有趣，对他来说DNS这套东西实在是太熟悉了，来来回回倒腾呗，但是对于我这个刚刚入门的人来说却是有着无穷的乐趣，毕竟我没做过嘛，啊哈哈~不多说，开搞！</p>
<p>又一次跑到云解析的页面，删去了原来的@的那条记录。新建了一个记录为 <code>cloud.imqishi.cn</code> ，又建了一个记录为 <code>blog.imqishi.cn</code> ，其记录值仍然指向云主机IP。显然，这里没有配置端口的设置，怎么样知道我这个域名对应的是想访问哪个端口呢？于是这个时候就用到了nginx—反向代理。反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。通过nginx监听80端口实现对通过不同域名的请求进行到其他端口的转发，从而可以通过域名就进行对该服务器不同端口的访问。对于hexo这种静态页面配置来说比较简单，只需要做一个简单的反向代理设置就可以了：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  blog.imqishi.cn;</div><div class="line"></div><div class="line">    <span class="attribute">access_log</span> /data/node/log/host.access.log  main;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Real-Ip <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-NginX-Proxy <span class="literal">true</span>;</div><div class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:4000/;</div><div class="line">        <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然而在配置Seafile的Seahub（负责云盘的web端处理）却遇到了不小的问题。第一个版本按照上面的方式只是将server_name和proxy_pass进行了修改，浏览器打开cloud.imqishi.cn可以正常访问，但是发现无法上传附件。到Seafile官网查看配置，才知道Seafile因为涉及到文件传输，和普通的配置有些不同，同时官方给出了一个推荐配置，并且使用fastcgi提供优化。配置文件如下：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span> <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span> cloud.imqishi.cn;</div><div class="line"></div><div class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$remote_addr</span>;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">fastcgi_pass</span>    <span class="number">127.0.0.1:8000</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>   SCRIPT_FILENAME     <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>   PATH_INFO           <span class="variable">$fastcgi_script_name</span>;</div><div class="line"></div><div class="line">        <span class="attribute">fastcgi_param</span>    SERVER_PROTOCOL        <span class="variable">$server_protocol</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>   QUERY_STRING        <span class="variable">$query_string</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>   REQUEST_METHOD      <span class="variable">$request_method</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>   CONTENT_TYPE        <span class="variable">$content_type</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>   CONTENT_LENGTH      <span class="variable">$content_length</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>    SERVER_ADDR         <span class="variable">$server_addr</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>    SERVER_PORT         <span class="variable">$server_port</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>    SERVER_NAME         <span class="variable">$server_name</span>;</div><div class="line">        <span class="attribute">fastcgi_param</span>   REMOTE_ADDR         <span class="variable">$remote_addr</span>;</div><div class="line"></div><div class="line">        <span class="attribute">access_log</span>      /var/log/nginx/seahub.access.log;</div><div class="line">        <span class="attribute">error_log</span>       /var/log/nginx/seahub.<span class="literal">error</span>.log;</div><div class="line">        <span class="attribute">fastcgi_read_timeout</span> <span class="number">36000</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> /seafhttp &#123;</div><div class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^/seafhttp(.*)$</span> <span class="variable">$1</span> <span class="literal">break</span>;</div><div class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8082;</div><div class="line">        <span class="attribute">client_max_body_size</span> <span class="number">0</span>;</div><div class="line">        <span class="attribute">proxy_connect_timeout</span>  <span class="number">36000s</span>;</div><div class="line">        <span class="attribute">proxy_read_timeout</span>  <span class="number">36000s</span>;</div><div class="line">        <span class="attribute">proxy_send_timeout</span>  <span class="number">36000s</span>;</div><div class="line">        <span class="attribute">send_timeout</span>  <span class="number">36000s</span>;</div><div class="line">        <span class="attribute">proxy_request_buffering</span> <span class="literal">off</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> /media &#123;</div><div class="line">        <span class="attribute">root</span> /root/nick/seafile-server-latest/seahub;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个配置文件呢其实是没有什么问题的，配置完成后重启seafile和seahub服务，seahub需要使用额外参数：在Seafile目录下使用./seahub.sh start-fastcgi</p>
<p>同时需要注意的是，配置完成后，需要去web端，点击个人头像下拉菜单的 系统管理 按钮，在左侧选择设置，并设置service_url为你的域名，如<a href="http://cloud.imqishi.cn" target="_blank" rel="external">http://cloud.imqishi.cn</a> ，设置file_server_root为 <a href="http://cloud.imqishi.cn/seafhttp" target="_blank" rel="external">http://cloud.imqishi.cn/seafhttp</a> ，文件下载服务才可正常使用。</p>
<p>开始的时候呢这个配置是没有问题的。然而过了一天以后再登录我的web云盘时，整个人都懵逼了，网页上空荡荡的几个input还有文字，所有的CSS都不见了！图片也加载不出来。就像平时改bug时做的一样，右键-审查元素，发现大量的js文件还有css文件都显示403错误…403…恩！马上就想到了权限问题！看了一下文件路径是在<strong>DIR</strong>/seafile-server-latest/seahub/media/，果断去给了个777…再次刷新我就懵逼了…一点儿效果都没有！重启nginx服务器，依然没有什么卵用…问了下吴神说应该是nginx配置出错嘞，我思来想去配置文件是官方提供的，看网上大家成功的也都是用的这份配置文件，变都没有变，为什么我的就不对呢？</p>
<p>这时候我把目光转向了seafile所在的文件夹，权限是root:root.我想起来之前有一次看到nginx配置的文章说nginx是由nginx还是worker用户去跑的，会不会是root权限太高了，所以无法加载呢？然后不明觉厉的我直接暴力怼了个chown -R nginx:nginx <strong>DIR</strong>/seafile. 这回倒好，直接报大错了！在进行重启服务的时候提示，没有nginx这个用户！我晕…默默改回root:root…</p>
<p>到这个时候我其实已经比较有眉目了，肯定是nginx的权限太低，导致了我无法访问里面的一些文件。可是ngnix到底怎么配置才好呢？这时候突然谷歌到一篇文章有一句话，说是在配置文件中使用root用户权限。对啊！这些基本通用的配置应该是在nginx.conf里面写的呀，一下子才反应过来…打开nginx.conf，赫然几个大字：user nginx wtf肯定就是他了！改成 user root 以后重启nginx，访问，一切ok！这一波找问题的经历，也是蛮醉的！</p>
<h2 id="又一次改动—nginx配置静态目录"><a href="#又一次改动—nginx配置静态目录" class="headerlink" title="又一次改动—nginx配置静态目录"></a>又一次改动—nginx配置静态目录</h2><p>之前配了个hexo的反代，那时候还很年轻，没写啥东西，现在突然想要写了，发现直接使用反代的话，相当于是hexo的4000端口服务器一直开着，使用命令+&amp;的方式也不能让它在后台运行。这我就懵了，总不能一直开着一个terminal挂着这个进程吧…遂去谷歌，发现这东西的正常用法是通过hexo编写md文件，然后使用generate命令生成静态文件，再提供给用户访问。静态文件在public目录下。还有一种方式是挂到github上，因为自己有这个云主机，就不如挂到自己这里咯~于是修改nginx的blog.conf</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#简单配置静态目录</span></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>       <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  blog.imqishi.cn;</div><div class="line">    <span class="attribute">root</span> /var/www/html/blog/public;</div><div class="line">    <span class="attribute">index</span> index.html;</div><div class="line"></div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样相当于由nginx直接接管了博客，而不是反代到4000端口的服务器上去运行，自然就不需要再hexo server咯~</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>通过鼓捣这个博客和云盘的搭建，对nginx的基本配置及反向代理配置有了一定的了解。并且在配置过程中遇到的问题进行排查，不再是以前那种盲目的搜索，而是发现问题，有针对性的搜索问题，思考问题。我觉得这是我以前很少有过的。过去总是想着能搭出来就行了，急于求成，一个弄不出来就删了转而投靠另一个容易搭建的，也不想去解决问题。我觉得这种思维以后一定要避免。第一篇文章虽然写的还是很皮毛，至少也算是开了个头啦~今后有些捣鼓的东西也要好好来这总结一下~~继续加油吧！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.imqishi.cn/2017/01/16/第一篇博客/" data-id="cj652vbny000f4a1y5dqcfj5q" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Mot-clés</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/SDN/">SDN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paper/">paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/trick/">trick</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设备识别/">设备识别</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Nuage de mot-clés</h3>
    <div class="widget tagcloud">
      <a href="/tags/SDN/" style="font-size: 15px;">SDN</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/leetcode/" style="font-size: 20px;">leetcode</a> <a href="/tags/paper/" style="font-size: 15px;">paper</a> <a href="/tags/trick/" style="font-size: 10px;">trick</a> <a href="/tags/设备识别/" style="font-size: 10px;">设备识别</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/09/设备识别论文阅读/">设备识别论文阅读</a>
          </li>
        
          <li>
            <a href="/2017/07/26/论文阅读报告/">论文阅读报告</a>
          </li>
        
          <li>
            <a href="/2017/07/25/今日论文-20170725/">今日论文</a>
          </li>
        
          <li>
            <a href="/2017/07/19/OpenDayLight配置/">SDN基础知识学习-环境配置</a>
          </li>
        
          <li>
            <a href="/2017/06/21/从生成括号到递归算法/">从生成括号到递归算法</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Nick<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>